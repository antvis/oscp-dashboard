<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>AntV OSCP</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_import/components/bar.a010c0a3.js">
<link rel="modulepreload" href="./_npm/@antv/g2@5.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/util@3.3.7/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/scale@0.4.16/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g@6.0.9/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/component@2.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/flru@1.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-canvas@2.0.7/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-dragndrop@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/event-emitter@0.1.3/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/coord@0.4.7/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/pdfast@0.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/fmin@0.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/gl-matrix@3.4.3/_esm.js">
<link rel="modulepreload" href="./_npm/tslib@2.6.3/_esm.js">
<link rel="modulepreload" href="./_npm/color-string@1.9.1/_esm.js">
<link rel="modulepreload" href="./_npm/fecha@4.2.3/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-camera-api@2.0.8/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-dom-mutation-observer-api@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-lite@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-web-animations-api@2.0.6/_esm.js">
<link rel="modulepreload" href="./_npm/svg-path-parser@1.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-canvas-path-generator@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-canvas-picker@2.0.6/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-canvas-renderer@2.0.6/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-dom-interaction@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-html-renderer@2.0.6/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-plugin-image-loader@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/util@2.0.17/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/color-name@1.1.4/_esm.js">
<link rel="modulepreload" href="./_npm/simple-swizzle@0.2.2/_esm.js">
<link rel="modulepreload" href="./_npm/eventemitter3@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/@antv/g-math@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/is-arrayish@0.3.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/pr.csv", {"name":"./data/pr.csv","mimeType":"text/csv","path":"./_file/data/pr.ad4eb427.csv","lastModified":1720511553267});

define({id: "fcb35a65", inputs: ["FileAttachment"], outputs: ["bar","pr"], body: async (FileAttachment) => {
const {bar} = await import("./_import/components/bar.a010c0a3.js");
const pr = FileAttachment("./data/pr.csv").csv({ typed: true });
return {bar,pr};
}});

define({id: "aae03d5a", inputs: ["view","Inputs"], outputs: ["ago"], body: (view,Inputs) => {
const ago = view(
  Inputs.radio(["1个月", "3个月", "半年", "1年"], {
    label: "时间范围",
    value: "1年",
  })
);
return {ago};
}});

define({id: "91c66a94", inputs: ["view","Inputs"], outputs: ["repo"], body: (view,Inputs) => {
const repo = view(
  Inputs.radio(["全部", "G2", "G6", "L7"], { label: "技术栈", value: "全部" })
);
return {repo};
}});

define({id: "b2a3a693", inputs: ["ago","pr","repo"], outputs: ["monthAgo","map","startDate","isContributor","selected","contributors","PRs","allPRs","ratio"], body: (ago,pr,repo) => {
function monthAgo(number = 1) {
  return (date) => {
    const month = date.getMonth() - number;
    date.setMonth(month);
    return date.toISOString();
  };
}

const map = new Map([
  ["1个月", monthAgo(1)],
  ["3个月", monthAgo(3)],
  ["半年", monthAgo(6)],
  ["1年", monthAgo(12)],
]);

const startDate = map.get(ago)(new Date());

const isContributor = (d) => d.contributor === 1;

const selected = pr
  .filter((d) => (repo === "全部" ? true : d.repo === repo))
  .filter((d) => new Date(d.mergeAt) > new Date(startDate));

const contributors = Array.from(
  new Set(selected.filter(isContributor).map((d) => d.userName))
).length;

const PRs = selected.filter(isContributor).length;
const allPRs = selected.length;
const ratio = ((PRs / allPRs) * 100).toFixed(0);
return {monthAgo,map,startDate,isContributor,selected,contributors,PRs,allPRs,ratio};
}});

define({id: "d415bfec", mode: "inline", inputs: ["contributors","display"], body: async (contributors,display) => {
display(await(
contributors
))
}});

define({id: "c75c6860", mode: "inline", inputs: ["PRs","display"], body: async (PRs,display) => {
display(await(
PRs
))
}});

define({id: "708c5c93", mode: "inline", inputs: ["selected","display"], body: async (selected,display) => {
display(await(
selected.length
))
}});

define({id: "38c5d340", mode: "inline", inputs: ["ratio","display"], body: async (ratio,display) => {
display(await(
ratio + `%`
))
}});

define({id: "71d4fe16", mode: "inline", inputs: ["resize","bar","selected","display"], body: async (resize,bar,selected,display) => {
display(await(
resize((width) => bar(selected, {width}))
))
}});

</script>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1>AntV OSCP</h1>
<div class="observablehq observablehq--block"><!--:fcb35a65:--></div>
<div class="observablehq observablehq--block"><!--:aae03d5a:--></div>
<div class="observablehq observablehq--block"><!--:91c66a94:--></div>
<div class="observablehq observablehq--block"><!--:b2a3a693:--></div>
<div class="grid grid-cols-4">
  <span class="card">
    <h2>社区贡献者</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:d415bfec:--></span>
  </span>
  <span class="card">
    <h2>社区贡献者 PR</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:c75c6860:--></span>
  </span>
  <span class="card">
    <h2>所有 PR</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:708c5c93:--></span>
  </span>
  <span class="card">
    <h2>社区贡献率</h2>
    <span class="big"><observablehq-loading></observablehq-loading><!--:38c5d340:--></span>
  </span>
</div>
<div class="grid grid-cols-1">
  <div class="card" style="padding:0">
    <observablehq-loading></observablehq-loading><!--:71d4fe16:-->
  </div>
</div>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2024-07-09T17:47:40">Jul 9, 2024</a>.</div>
</footer>
</div>
