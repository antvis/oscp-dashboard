/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@antv/g-camera-api@2.0.8/dist/index.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{getAngle as t,CameraType as i,deg2rad as o,createVec3 as e,runtime as n,Camera as a}from"../g-lite@2.0.5/_esm.js";import{__extends as s,__spreadArray as r,__read as l}from"../../tslib@2.6.3/_esm.js";import{isString as h,isNumber as m}from"../util@3.3.7/_esm.js";import{quat as c,mat4 as p,vec3 as d}from"../../gl-matrix@3.4.3/_esm.js";var u=function(a){function u(){var t=a.apply(this,r([],l(arguments),!1))||this;return t.landmarks=[],t}return s(u,a),u.prototype.rotate=function(e,n,a){if(this.relElevation=t(n),this.relAzimuth=t(e),this.relRoll=t(a),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===i.EXPLORING){var s=c.setAxisAngle(c.create(),[1,0,0],o((this.rotateWorld?1:-1)*this.relElevation)),r=c.setAxisAngle(c.create(),[0,1,0],o((this.rotateWorld?1:-1)*this.relAzimuth)),l=c.setAxisAngle(c.create(),[0,0,1],o(this.relRoll)),h=c.multiply(c.create(),r,s);h=c.multiply(c.create(),h,l);var m=p.fromQuat(p.create(),h);p.translate(this.matrix,this.matrix,[0,0,-this.distance]),p.multiply(this.matrix,this.matrix,m),p.translate(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===i.ORBITING||this.type===i.EXPLORING?this._getPosition():this.type===i.TRACKING&&this._getFocalPoint(),this._update(),this},u.prototype.pan=function(t,i){var o=e(t,i,0),n=d.clone(this.position);return d.add(n,n,d.scale(d.create(),this.right,o[0])),d.add(n,n,d.scale(d.create(),this.up,o[1])),this._setPosition(n),this.triggerUpdate(),this},u.prototype.dolly=function(t){var o=this.forward,e=d.clone(this.position),n=this.dollyingStep,a=this.distance+t*this.dollyingStep;return n=Math.max(Math.min(a,this.maxDistance),this.minDistance)-this.distance,e[0]+=n*o[0],e[1]+=n*o[1],e[2]+=n*o[2],this._setPosition(e),this.type===i.ORBITING||this.type===i.EXPLORING?this._getDistance():this.type===i.TRACKING&&d.add(this.focalPoint,e,this.distanceVector),this.triggerUpdate(),this},u.prototype.cancelLandmarkAnimation=function(){void 0!==this.landmarkAnimationID&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},u.prototype.createLandmark=function(t,i){var o,e,a,s;void 0===i&&(i={});var r=i.position,l=void 0===r?this.position:r,h=i.focalPoint,m=void 0===h?this.focalPoint:h,c=i.roll,u=i.zoom,v=new n.CameraContribution;v.setType(this.type,void 0),v.setPosition(l[0],null!==(o=l[1])&&void 0!==o?o:this.position[1],null!==(e=l[2])&&void 0!==e?e:this.position[2]),v.setFocalPoint(m[0],null!==(a=m[1])&&void 0!==a?a:this.focalPoint[1],null!==(s=m[2])&&void 0!==s?s:this.focalPoint[2]),v.setRoll(null!=c?c:this.roll),v.setZoom(null!=u?u:this.zoom);var f={name:t,matrix:p.clone(v.getWorldTransform()),right:d.clone(v.right),up:d.clone(v.up),forward:d.clone(v.forward),position:d.clone(v.getPosition()),focalPoint:d.clone(v.getFocalPoint()),distanceVector:d.clone(v.getDistanceVector()),distance:v.getDistance(),dollyingStep:v.getDollyingStep(),azimuth:v.getAzimuth(),elevation:v.getElevation(),roll:v.getRoll(),relAzimuth:v.relAzimuth,relElevation:v.relElevation,relRoll:v.relRoll,zoom:v.getZoom()};return this.landmarks.push(f),f},u.prototype.gotoLandmark=function(t,i){var o=this;void 0===i&&(i={});var e=h(t)?this.landmarks.find((function(i){return i.name===t})):t;if(e){var a=m(i)?{duration:i}:i,s=a.easing,r=void 0===s?"linear":s,l=a.duration,c=void 0===l?100:l,p=a.easingFunction,u=void 0===p?void 0:p,v=a.onfinish,f=void 0===v?void 0:v,g=a.onframe,y=void 0===g?void 0:g;this.cancelLandmarkAnimation();var A,P=e.position,x=e.focalPoint,R=e.zoom,z=e.roll,I=u||n.EasingFunction(r),k=function(){o.setFocalPoint(x),o.setPosition(P),o.setRoll(z),o.setZoom(R),o.computeMatrix(),o.triggerUpdate(),null==f||f()};if(0===c)return k();var E=function(t){void 0===A&&(A=t);var i=t-A;if(i>=c)k();else{var e,n,a=I(i/c),s=d.create(),r=d.create();if(d.lerp(s,o.focalPoint,x,a),d.lerp(r,o.position,P,a),n=o.roll*(1-a)+z*a,e=o.zoom*(1-a)+R*a,o.setFocalPoint(s),o.setPosition(r),o.setRoll(n),o.setZoom(e),d.dist(s,x)+d.dist(r,P)<=.01&&null==R&&null==z)return k();o.computeMatrix(),o.triggerUpdate(),i<c&&(null==y||y(a),o.landmarkAnimationID=o.canvas.requestAnimationFrame(E))}};this.canvas.requestAnimationFrame(E)}},u}(a);n.CameraContribution=u;export{u as AdvancedCamera};export default null;
